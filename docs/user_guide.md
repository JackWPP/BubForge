# 用户手册

## 1. 首次启动
1. 运行：`python main.py`
2. 点击顶部“选择项目”，选择一个目录作为项目根目录
3. 程序会自动创建项目结构：`project.yaml`、`sources.csv`、`frames/`、`metadata/`、`logs/`

## 2. 打开视频
点击“打开视频”选择本地视频文件，程序会：
- 将视频登记到 `sources.csv`
- 计算视频唯一标识 `video_id`
- 读取已有关键帧元数据并恢复到列表/时间线

## 3. 工作区（像剪辑软件）
界面采用可拖拽 Dock 工作区：
- 底部：时间线
- 左侧：素材选择（关键帧/区间）
- 右侧：导出面板

可用操作：
- 拖动面板标题栏，改变停靠位置或浮动
- 菜单 `视图` 隐藏/显示面板
- 点击“重置工作区”恢复默认布局
- 工作区布局会自动保存并在下次恢复

## 4. 预览控制
### 4.1 显示模式
- “比例”：`比例锁定` / `自由拉伸`
- “显示”：`适配` / `100%` / `150%` / `200%`

### 4.2 快捷键
- `Space`：播放/暂停
- `A / D`：上一帧/下一帧
- `J / L`：连续快退/快进（长按）
- `← / →`：1 帧步进
- `Shift + ← / →`：10 帧步进
- `Ctrl + ← / →`：约 1 秒步进
- `Ctrl + Shift + ← / →`：约 5 秒步进

## 5. 关键帧流程
1. 定位到目标画面
2. 按 `S` 或点击“保存关键帧”
3. 当前帧会落盘到：`frames/<video_folder>/keyframes/`
4. 元数据写入 `metadata/frames.csv`
5. 界面会自动跳到下一帧，便于连续挑帧

补充：
- 已保存关键帧会显示在左侧列表
- 关键帧会显示为时间线标记

## 6. 区间流程
1. 按 `I` 设置 In
2. 按 `O` 设置 Out
3. Out 设置成功后，区间会自动加入“区间”列表（去重）
4. 也可按 `Enter` 手动添加区间

抽帧方式：
- 按 `E` 执行区间抽帧（按右侧 FPS 设置）
- 输出到 `frames/<video_folder>/ranges/`
- 同步写入 `metadata/frames.csv`

## 7. 数据集骨架导出
右侧导出面板选择格式后点击“开始导出”：
- `RawFrames + Metadata`
- `Ultralytics Skeleton`
- `COCO Skeleton`

注意：
- “开始导出”是导出骨架目录
- `E` 是执行区间抽帧，两者不是同一个动作

## 8. 常见问题入口
请查看：`docs/troubleshooting.md`
